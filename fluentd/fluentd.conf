<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<filter docker.ocserv>
  @type record_transformer
  enable_ruby
  <record>
    log ${record["log"]}
  </record>
  remove_keys container_id,container_name,source
</filter>

<filter docker.ocserv>
  @type grep
  <regexp>
    key log
    pattern /ocserv/
  </regexp>
</filter>

<match docker.ocserv>
  @type kafka2
  brokers kafka:9092
  default_topic ocserv
  default_message_key ocserv-log
  compression_codec gzip
  required_acks 1
  <format>
    @type ltsv
  </format>
  <buffer topic>
    flush_interval 10s
  </buffer>
</match>
